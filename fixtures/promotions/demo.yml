root: supplier-promotions

nodes:
  supplier-promotions:
    promotions: [coke-10]
    output: pass-through
    next: base-promotions

  base-promotions:
    promotions: [meal-deal, bogof-drinks, 3-for-2, sports-nutrition-tiered]
    output: split
    non-participating: staff-discount

  staff-discount:
    promotions: [staff-discount]
    output: pass-through

promotions:
  coke-10:
    type: direct_discount
    name: "10% Off Coca Cola"
    tags: [coke]
    discount:
      type: percentage_off
      amount: 10%

  staff-discount:
    type: direct_discount
    name: 5% Staff discount
    qualification:
      rules:
        - has_none: [staff-discount-exempt]
    discount:
      type: percentage_off
      amount: 5%

  bogof-drinks:
    type: positional_discount
    name: Buy One Get One Free Drinks
    tags: [drink]
    size: 2
    positions: [1]
    discount:
      type: percentage_off
      amount: 100%

  3-for-2:
    type: positional_discount
    name: 3-for-2 Vitamins
    qualification:
      rules:
        - has_any: [vitamins]
    size: 3
    positions: [2]
    discount:
      type: percentage_off
      amount: 100%

  meal-deal:
    type: mix_and_match
    name: "Â£3.80 Meal Deal"
    slots:
      - name: main
        tags: [main]
        min: 1
        max: 1
      - name: drink
        tags: [drink]
        min: 1
        max: 1
      - name: snack
        tags: [snack]
        min: 1
        max: 1
    discount:
      type: fixed_total
      amount: 3.80 GBP

  sports-nutrition-tiered:
    type: tiered_threshold
    name: "Sports Nutrition Tiered Saver"
    tiers:
      - lower_threshold:
          monetary: 10.00 GBP
        upper_threshold:
          monetary: 50.00 GBP
        contribution_tags: [sports-nutrition]
        discount_tags: [sports-nutrition]
        discount:
          type: percent_each_item
          amount: 10%
      - lower_threshold:
          monetary: 50.00 GBP
        upper_threshold:
          monetary: 100.00 GBP
        contribution_tags: [sports-nutrition]
        discount_tags: [sports-nutrition]
        discount:
          type: percent_each_item
          amount: 20%
